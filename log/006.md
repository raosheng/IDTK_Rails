### 第 006 天（20161015）

更新 Dash for macOS Capybara [Cheatsheet](https://github.com/Kapeli/cheatsheets/pull/243/files) 。

对于 `data: { confirm: "Sample text.." }` 不知道如何使用 JavaScript 生成更好看的确认方式代替浏览器原生的确认方式。迅速搜索了下解决办法，[t4t5/sweetalert](https://github.com/t4t5/sweetalert) 一个代替原生确认的前端库，[mois3x/sweet-alert-rails-confirm](https://github.com/mois3x/sweet-alert-rails-confirm) 是在前者基础上用来在 Rails 中代替默认确认的 Gem 。另外一个类似于 sweetalert 的库为 [Bootbox](http://bootboxjs.com/) 一个基于 Bootstrap 的前端确认库。

[jquery-ujs](https://github.com/rails/jquery-ujs) 不是 jQuery UI ，它的作用是用来处理定制的 `data-` 属性从而不使用链接的默认事件发起方式例如 `GET` 。


替换默认的确认的方式是复写在 `jquery-ujs` 中的事件处理函数，如下所示（更多细节可以阅读 [Custom dialog for data-confirm in Rails](http://thelazylog.com/custom-dialog-for-data-confirm-in-rails/) ）

```js
$.rails.allowAction = function(link){
  if (link.data("confirm") == undefined){
    return true;
  }
  $.rails.showConfirmationDialog(link);
  return false;
}
```

建立新模型并添加两个模型之间的关系（一个项目有多个工单），

```bash
rails g model project name:string description:string
rails g model ticket name:string description:string project:references
```

`project:references` 在 `ticket` 模型中定义 `project_id` 的外键并。

```ruby
class CreateTickets < ActiveRecord::Migration[5.0]
  def change
    create_table :tickets do |t|
      t.string :name
      t.string :description
      t.references :project, foreign_key: true
      t.timestamps
    end
  end
end
```

Rails in Action 4 中用 [simple_form](https://github.com/plataformatec/simple_form) 来处理嵌套资源的表单生成，下面是不使用这个 Gem 来处理嵌套资源表单的方法，

```html
<%= form_for [project, ticket] do |form| %>
  <%= form.text_field :name %>
  <%= form.text_field :description %>
  <%= form.submit "Create Ticket" %>
<% end %>
```

不知道是因该在 `before` 块中使用 `FactoryGirl` 来创建测试数据还是应该是用 `let` 来创建测试数据。 `let` 创建一个和符号同样名字的函数，每当函数被调用块内的代码就会被执行。

```ruby
# lazy-loaded
let(:project) { FactoryGirl.create(:project) }
# evaluated immediately before test start
let!(:project) { FactoryGirl.create(:project) }
```
